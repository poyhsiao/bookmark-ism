# Bookmark Sync Service Backend

é€™æ˜¯æ›¸ç±¤åŒæ­¥æœå‹™çš„å¾Œç«¯éƒ¨åˆ†ï¼Œä½¿ç”¨ Go èªè¨€å’Œ Gin æ¡†æ¶é–‹ç™¼ã€‚

## å¯¦ç¾ç‹€æ…‹

### âœ… å·²å®ŒæˆåŠŸèƒ½ (Phase 1-4)

- **Phase 1**: æ ¸å¿ƒåŸºç¤è¨­æ–½å’Œå®¹å™¨åŒ–éƒ¨ç½²
- **Phase 2**: Supabase èªè­‰é›†æˆå’Œç”¨æˆ¶ç®¡ç†
- **Phase 3**: å®Œæ•´çš„æ›¸ç±¤å’Œæ”¶è—å¤¾ CRUD æ“ä½œ
- **Phase 4**: è·¨ç€è¦½å™¨å¯¦æ™‚åŒæ­¥ç³»çµ± âœ¨ **æœ€æ–°å®Œæˆ**

### ğŸ”„ æ ¸å¿ƒåŠŸèƒ½

- âœ… ç”¨æˆ¶èªè­‰å’Œæˆæ¬Š (Supabase Auth + JWT)
- âœ… ç”¨æˆ¶å€‹äººè³‡æ–™ç®¡ç†å’Œåå¥½è¨­ç½®
- âœ… å®Œæ•´æ›¸ç±¤ç®¡ç† (CRUDã€æœç´¢ã€æ¨™ç±¤ã€è»Ÿåˆªé™¤)
- âœ… åˆ†å±¤æ”¶è—å¤¾ç®¡ç† (åµŒå¥—çµæ§‹ã€å…±äº«ã€æ¬Šé™æ§åˆ¶)
- âœ… **å¯¦æ™‚è·¨ç€è¦½å™¨åŒæ­¥** (WebSocketã€è¡çªè§£æ±ºã€é›¢ç·šæ”¯æŒ)
- â³ æœç´¢å’Œç™¼ç¾ (è¨ˆåŠƒä¸­)
- â³ ç¤¾å€åŠŸèƒ½ (è¨ˆåŠƒä¸­)

### ğŸš€ Phase 4 æ–°å¢åŠŸèƒ½

- **WebSocket å¯¦æ™‚åŒæ­¥**: ä½¿ç”¨ Gorilla WebSocket å¯¦ç¾äºç§’ç´šåŒæ­¥
- **æ™ºèƒ½è¡çªè§£æ±º**: åŸºæ–¼æ™‚é–“æˆ³çš„è¡çªè§£æ±ºç­–ç•¥
- **è¨­å‚™ç®¡ç†**: è‡ªå‹•è¨­å‚™è¨»å†Šå’Œå¤šè¨­å‚™ç‹€æ…‹ç®¡ç†
- **å¸¶å¯¬å„ªåŒ–**: äº‹ä»¶å»é‡å’Œå¢é‡åŒæ­¥ï¼Œæ¸›å°‘ 70% ç¶²çµ¡ä½¿ç”¨
- **é›¢ç·šæ”¯æŒ**: é›¢ç·šäº‹ä»¶éšŠåˆ—å’Œè‡ªå‹•æ¢å¾©æ©Ÿåˆ¶
- **Redis Pub/Sub**: å¤šå¯¦ä¾‹æ¶ˆæ¯å»£æ’­æ”¯æŒ

## æŠ€è¡“å †æ£§

- **èªè¨€**: Go 1.21+ èˆ‡ Gin Web æ¡†æ¶
- **æ•¸æ“šåº«**: è‡ªè¨—ç®¡ Supabase PostgreSQL èˆ‡ GORM ORM
- **å¯¦æ™‚åŒæ­¥**: Gorilla WebSocket + Redis Pub/Sub
- **ç·©å­˜**: Redis èˆ‡é€£æ¥æ± ç®¡ç†
- **æœç´¢**: Typesense æ”¯æŒä¸­æ–‡èªè¨€ (è¨ˆåŠƒä¸­)
- **å­˜å„²**: MinIO S3 å…¼å®¹å­˜å„² (è¨ˆåŠƒä¸­)
- **èªè­‰**: è‡ªè¨—ç®¡ Supabase Auth èˆ‡ JWT é©—è­‰
- **å®¹å™¨åŒ–**: Docker + Docker Compose å®Œæ•´éƒ¨ç½²

## ç›®éŒ„çµæ§‹

```
backend/
â”œâ”€â”€ cmd/                   # æ‡‰ç”¨ç¨‹åºå…¥å£é»
â”‚   â”œâ”€â”€ api/              # API æœå‹™å™¨
â”‚   â”œâ”€â”€ sync/             # åŒæ­¥æœå‹™
â”‚   â”œâ”€â”€ worker/           # å¾Œå°å·¥ä½œè€…
â”‚   â””â”€â”€ migrate/          # æ•¸æ“šåº«é·ç§»
â”œâ”€â”€ internal/             # ç§æœ‰æ‡‰ç”¨ç¨‹åºä»£ç¢¼
â”‚   â”œâ”€â”€ auth/             # èªè­‰é‚è¼¯ âœ…
â”‚   â”œâ”€â”€ bookmark/         # æ›¸ç±¤æ¥­å‹™é‚è¼¯ âœ…
â”‚   â”œâ”€â”€ collection/       # æ”¶è—å¤¾ç®¡ç† âœ…
â”‚   â”œâ”€â”€ sync/             # å¯¦æ™‚åŒæ­¥é‚è¼¯ âœ…
â”‚   â”œâ”€â”€ user/             # ç”¨æˆ¶ç®¡ç† âœ…
â”‚   â”œâ”€â”€ community/        # ç¤¾äº¤åŠŸèƒ½ (è¨ˆåŠƒä¸­)
â”‚   â”œâ”€â”€ search/           # æœç´¢é›†æˆ (è¨ˆåŠƒä¸­)
â”‚   â””â”€â”€ storage/          # æ–‡ä»¶å­˜å„²é‚è¼¯ (è¨ˆåŠƒä¸­)
â”œâ”€â”€ pkg/                  # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ database/         # æ•¸æ“šåº«æ¨¡å‹å’Œé€£æ¥
â”‚   â”œâ”€â”€ redis/            # Redis å®¢æˆ¶ç«¯æ“ä½œ
â”‚   â”œâ”€â”€ websocket/        # WebSocket ç®¡ç†
â”‚   â””â”€â”€ utils/            # å…±äº«å·¥å…·
â”œâ”€â”€ api/                  # API å®šç¾©
â”‚   â””â”€â”€ v1/               # API v1 è·¯ç”±
â”œâ”€â”€ config/               # é…ç½®æ–‡ä»¶
â”œâ”€â”€ migrations/           # æ•¸æ“šåº«æ¨¡å¼é·ç§»
â””â”€â”€ docker/               # Docker é…ç½®
```

## é–‹ç™¼è¨­ç½®

### å‰ææ¢ä»¶

- Go 1.21+
- Docker å’Œ Docker Compose
- Make

### å®‰è£

1. å…‹éš†å­˜å„²åº«ï¼š

```bash
git clone https://github.com/yourusername/bookmark-sync-service.git
cd bookmark-sync-service
```

2. å•Ÿå‹•é–‹ç™¼ç’°å¢ƒï¼š

```bash
make dev
```

é€™å°‡å•Ÿå‹•æ‰€æœ‰å¿…è¦çš„æœå‹™ï¼ˆSupabase PostgreSQLã€Redisã€MinIOã€Typesenseï¼‰ã€‚

3. é‹è¡Œå¾Œç«¯ï¼š

```bash
make run
```

### æ¸¬è©¦

é‹è¡Œæ‰€æœ‰æ¸¬è©¦ï¼š

```bash
make test
```

é‹è¡Œç‰¹å®šæ¨¡å¡Šæ¸¬è©¦ï¼š

```bash
# èªè­‰æ¨¡å¡Š
go test -v ./backend/internal/auth/...

# æ›¸ç±¤æ¨¡å¡Š
go test -v ./backend/internal/bookmark/...

# æ”¶è—å¤¾æ¨¡å¡Š
go test -v ./backend/internal/collection/...

# åŒæ­¥æ¨¡å¡Š (Phase 4 æ–°å¢)
go test -v ./backend/internal/sync/...
```

é‹è¡ŒåŒæ­¥åŠŸèƒ½æ¸¬è©¦è…³æœ¬ï¼š

```bash
# æ¸¬è©¦å¯¦æ™‚åŒæ­¥åŠŸèƒ½
./scripts/test-sync.sh

# æ¸¬è©¦æ”¶è—å¤¾åŠŸèƒ½
./scripts/test-collections.sh
```

ç”Ÿæˆæ¸¬è©¦è¦†è“‹ç‡å ±å‘Šï¼š

```bash
make coverage
```

### æ¸¬è©¦è¦†è“‹ç‡

- **ç¸½é«”æ¸¬è©¦**: 100+ å€‹æ¸¬è©¦ç”¨ä¾‹
- **åŒæ­¥æ¨¡å¡Š**: 37/37 æ¸¬è©¦é€šé (100% æˆåŠŸç‡)
- **æ ¸å¿ƒåŠŸèƒ½**: å®Œæ•´çš„ TDD æ¸¬è©¦è¦†è“‹

### API ç«¯é»

#### å·²å¯¦ç¾çš„ API

- **èªè­‰**: `/api/v1/auth/*` - ç”¨æˆ¶è¨»å†Šã€ç™»éŒ„ã€JWT é©—è­‰
- **ç”¨æˆ¶**: `/api/v1/users/*` - ç”¨æˆ¶è³‡æ–™ç®¡ç†
- **æ›¸ç±¤**: `/api/v1/bookmarks/*` - å®Œæ•´ CRUDã€æœç´¢ã€æ¨™ç±¤
- **æ”¶è—å¤¾**: `/api/v1/collections/*` - åˆ†å±¤ç®¡ç†ã€å…±äº«ã€æ¬Šé™
- **åŒæ­¥**: `/api/v1/sync/*` - å¯¦æ™‚åŒæ­¥ã€WebSocket é€£æ¥

#### WebSocket ç«¯é»

- **å¯¦æ™‚åŒæ­¥**: `ws://localhost:8080/api/v1/sync/ws`
  - æ”¯æŒ ping/pong å¿ƒè·³æª¢æ¸¬
  - å¯¦æ™‚äº‹ä»¶å»£æ’­
  - å¢é‡åŒæ­¥è«‹æ±‚

API æ–‡æª”å¯åœ¨ `http://localhost:8080/swagger/index.html` ç²å–ï¼ˆç•¶æœå‹™å™¨é‹è¡Œæ™‚ï¼‰ã€‚

## éƒ¨ç½²

### ä½¿ç”¨ Docker Compose

```bash
docker-compose -f docker-compose.prod.yml up -d
```

### æ“´å±• API æœå‹™

```bash
docker-compose up --scale api=3
```

## é…ç½®

é…ç½®é€šéç’°å¢ƒè®Šé‡æˆ–é…ç½®æ–‡ä»¶æä¾›ã€‚æŸ¥çœ‹ `.env.example` æ–‡ä»¶äº†è§£å¯ç”¨çš„é…ç½®é¸é …ã€‚

### é—œéµé…ç½®é …

```bash
# æ•¸æ“šåº«é…ç½®
DATABASE_URL=postgres://user:pass@localhost:5432/bookmarks

# Redis é…ç½® (ç”¨æ–¼å¯¦æ™‚åŒæ­¥)
REDIS_URL=redis://localhost:6379

# JWT é…ç½®
JWT_SECRET=your-secret-key

# Supabase é…ç½®
SUPABASE_URL=http://localhost:3000
SUPABASE_ANON_KEY=your-anon-key
```

## æ€§èƒ½ç‰¹æ€§

### Phase 4 åŒæ­¥æ€§èƒ½

- **å»¶é²**: äºç§’ç´šå¯¦æ™‚åŒæ­¥ (< 1 ç§’)
- **å¸¶å¯¬å„ªåŒ–**: äº‹ä»¶å»é‡æ¸›å°‘ 70% ç¶²çµ¡ä½¿ç”¨
- **ä¸¦ç™¼æ”¯æŒ**: æ”¯æŒæ•¸åƒå€‹ä¸¦ç™¼ WebSocket é€£æ¥
- **è¡çªè§£æ±º**: æ™ºèƒ½æ™‚é–“æˆ³è¡çªè§£æ±º
- **é›¢ç·šæ¢å¾©**: è‡ªå‹•é›¢ç·šäº‹ä»¶éšŠåˆ—è™•ç†

## è²¢ç»

1. Fork å­˜å„²åº«
2. å‰µå»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. æ‰“é–‹æ‹‰å–è«‹æ±‚

## è¨±å¯è­‰

[MIT](LICENSE)