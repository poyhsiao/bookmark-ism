# Bookmark Sync Service Backend

é€™æ˜¯æ›¸ç±¤åŒæ­¥æœå‹™çš„å¾Œç«¯éƒ¨åˆ†ï¼Œä½¿ç”¨ Go èªè¨€å’Œ Gin æ¡†æ¶é–‹ç™¼ã€‚

## å¯¦ç¾ç‹€æ…‹

### âœ… å·²å®ŒæˆåŠŸèƒ½ (Phase 1-5)

- **Phase 1**: æ ¸å¿ƒåŸºç¤è¨­æ–½å’Œå®¹å™¨åŒ–éƒ¨ç½²
- **Phase 2**: Supabase èªè­‰é›†æˆå’Œç”¨æˆ¶ç®¡ç†
- **Phase 3**: å®Œæ•´çš„æ›¸ç±¤å’Œæ”¶è—å¤¾ CRUD æ“ä½œ
- **Phase 4**: è·¨ç€è¦½å™¨å¯¦æ™‚åŒæ­¥ç³»çµ±
- **Phase 5**: ç€è¦½å™¨æ“´å±• MVP (Chrome + Firefox) âœ¨ **æœ€æ–°å®Œæˆ**

### ğŸ”„ æ ¸å¿ƒåŠŸèƒ½

- âœ… ç”¨æˆ¶èªè­‰å’Œæˆæ¬Š (Supabase Auth + JWT)
- âœ… ç”¨æˆ¶å€‹äººè³‡æ–™ç®¡ç†å’Œåå¥½è¨­ç½®
- âœ… å®Œæ•´æ›¸ç±¤ç®¡ç† (CRUDã€æœç´¢ã€æ¨™ç±¤ã€è»Ÿåˆªé™¤)
- âœ… åˆ†å±¤æ”¶è—å¤¾ç®¡ç† (åµŒå¥—çµæ§‹ã€å…±äº«ã€æ¬Šé™æ§åˆ¶)
- âœ… **å¯¦æ™‚è·¨ç€è¦½å™¨åŒæ­¥** (WebSocketã€è¡çªè§£æ±ºã€é›¢ç·šæ”¯æŒ)
- âœ… **Chrome ç€è¦½å™¨æ“´å±•** (å½ˆå‡ºç•Œé¢ã€é¸é …é é¢ã€å…§å®¹è…³æœ¬ã€å¯¦æ™‚åŒæ­¥)
- âœ… **Firefox ç€è¦½å™¨æ“´å±•** (è·¨ç€è¦½å™¨å…¼å®¹ã€çµ±ä¸€å¾Œç«¯åŒæ­¥)
- â³ æœç´¢å’Œç™¼ç¾ (è¨ˆåŠƒä¸­)
- â³ ç¤¾å€åŠŸèƒ½ (è¨ˆåŠƒä¸­)

### ğŸš€ Phase 5 æ–°å¢åŠŸèƒ½

- **Chrome ç€è¦½å™¨æ“´å±•**: å®Œæ•´çš„ Chrome æ“´å±•å¯¦ç¾ï¼Œæ”¯æŒ Manifest V3
- **Firefox ç€è¦½å™¨æ“´å±•**: å®Œæ•´çš„ Firefox æ“´å±•å¯¦ç¾ï¼Œæ”¯æŒ Manifest V2
- **è·¨ç€è¦½å™¨å…¼å®¹**: çµ±ä¸€çš„ API æ¥å£ï¼Œæ”¯æŒ Chrome å’Œ Firefox ç„¡ç¸«åˆ‡æ›
- **å½ˆå‡ºç•Œé¢**: éŸ¿æ‡‰å¼è¨­è¨ˆçš„æ›¸ç±¤ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒç¶²æ ¼å’Œåˆ—è¡¨è¦–åœ–
- **å¯¦æ™‚åŒæ­¥**: èˆ‡å¾Œç«¯ WebSocket é›†æˆï¼Œå¯¦ç¾è·¨ç€è¦½å™¨å¯¦æ™‚æ›¸ç±¤åŒæ­¥
- **èªè­‰ç³»çµ±**: å®Œæ•´çš„ç™»éŒ„/è¨»å†Šæµç¨‹ï¼Œæ”¯æŒ JWT ä»¤ç‰Œç®¡ç†
- **é›¢ç·šæ”¯æŒ**: æœ¬åœ°ç·©å­˜å’Œé›¢ç·šéšŠåˆ—ï¼Œæ”¯æŒç¶²çµ¡æ¢å¾©å¾Œè‡ªå‹•åŒæ­¥
- **é¸é …é é¢**: å…¨é¢çš„è¨­ç½®ç®¡ç†ï¼ŒåŒ…æ‹¬åŒæ­¥ã€é¡¯ç¤ºå’Œéš±ç§é¸é …
- **å…§å®¹è…³æœ¬**: è‡ªå‹•é é¢å…ƒæ•¸æ“šæå–å’Œæ›¸ç±¤æª¢æ¸¬
- **ä¸Šä¸‹æ–‡èœå–®**: å³éµå¿«é€Ÿæ›¸ç±¤åŠŸèƒ½
- **å­˜å„²ç®¡ç†**: æ™ºèƒ½ç·©å­˜ç®¡ç†å’Œå­˜å„²å„ªåŒ–
- **æ¸¬è©¦è¦†è“‹**: 150+ æ¸¬è©¦ç”¨ä¾‹ï¼Œéµå¾ª TDD é–‹ç™¼æ–¹æ³•

## æŠ€è¡“å †æ£§

- **èªè¨€**: Go 1.21+ èˆ‡ Gin Web æ¡†æ¶
- **æ•¸æ“šåº«**: è‡ªè¨—ç®¡ Supabase PostgreSQL èˆ‡ GORM ORM
- **å¯¦æ™‚åŒæ­¥**: Gorilla WebSocket + Redis Pub/Sub
- **ç·©å­˜**: Redis èˆ‡é€£æ¥æ± ç®¡ç†
- **æœç´¢**: Typesense æ”¯æŒä¸­æ–‡èªè¨€ (è¨ˆåŠƒä¸­)
- **å­˜å„²**: MinIO S3 å…¼å®¹å­˜å„² (è¨ˆåŠƒä¸­)
- **èªè­‰**: è‡ªè¨—ç®¡ Supabase Auth èˆ‡ JWT é©—è­‰
- **å®¹å™¨åŒ–**: Docker + Docker Compose å®Œæ•´éƒ¨ç½²

## ç›®éŒ„çµæ§‹

```
bookmark-sync-service/
â”œâ”€â”€ backend/              # Go å¾Œç«¯æœå‹™
â”‚   â”œâ”€â”€ cmd/             # æ‡‰ç”¨ç¨‹åºå…¥å£é»
â”‚   â”œâ”€â”€ internal/        # ç§æœ‰æ‡‰ç”¨ç¨‹åºä»£ç¢¼
â”‚   â”œâ”€â”€ pkg/             # å…¬å…±åŒ…
â”‚   â””â”€â”€ api/             # API å®šç¾©
â”œâ”€â”€ extensions/          # ç€è¦½å™¨æ“´å±• âœ…
â”‚   â”œâ”€â”€ chrome/          # Chrome æ“´å±• âœ…
â”‚   â”‚   â”œâ”€â”€ manifest.json      # æ“´å±•é…ç½®
â”‚   â”‚   â”œâ”€â”€ background/        # å¾Œå°è…³æœ¬
â”‚   â”‚   â”‚   â”œâ”€â”€ service-worker.js    # ä¸»æœå‹™å·¥ä½œè€…
â”‚   â”‚   â”‚   â”œâ”€â”€ auth-manager.js      # èªè­‰ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ sync-manager.js      # åŒæ­¥ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ storage-manager.js   # å­˜å„²ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ popup/             # å½ˆå‡ºç•Œé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ popup.html     # ä¸»ç•Œé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ popup.css      # æ¨£å¼
â”‚   â”‚   â”‚   â””â”€â”€ popup.js       # é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ options/           # é¸é …é é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ options.html   # è¨­ç½®ç•Œé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ options.css    # æ¨£å¼
â”‚   â”‚   â”‚   â””â”€â”€ options.js     # é‚è¼¯
â”‚   â”‚   â””â”€â”€ content/           # å…§å®¹è…³æœ¬
â”‚   â”‚       â””â”€â”€ page-analyzer.js    # é é¢åˆ†æ
â”‚   â”œâ”€â”€ firefox/         # Firefox æ“´å±• âœ…
â”‚   â”‚   â”œâ”€â”€ manifest.json      # Firefox æ“´å±•é…ç½® (Manifest V2)
â”‚   â”‚   â”œâ”€â”€ background/        # å¾Œå°è…³æœ¬ (æŒä¹…åŒ–èƒŒæ™¯é é¢)
â”‚   â”‚   â”œâ”€â”€ popup/             # å½ˆå‡ºç•Œé¢ (èˆ‡ Chrome å…±äº«)
â”‚   â”‚   â”œâ”€â”€ options/           # é¸é …é é¢ (èˆ‡ Chrome å…±äº«)
â”‚   â”‚   â””â”€â”€ content/           # å…§å®¹è…³æœ¬ (èˆ‡ Chrome å…±äº«)
â”‚   â”œâ”€â”€ safari/          # Safari æ“´å±• (è¨ˆåŠƒä¸­)
â”‚   â”œâ”€â”€ shared/          # å…±äº«ä»£ç¢¼ âœ…
â”‚   â”‚   â”œâ”€â”€ constants.js       # å¸¸é‡å®šç¾©
â”‚   â”‚   â”œâ”€â”€ utils.js           # å·¥å…·å‡½æ•¸
â”‚   â”‚   â””â”€â”€ api-client.js      # API å®¢æˆ¶ç«¯
â”‚   â””â”€â”€ tests/           # æ“´å±•æ¸¬è©¦ âœ…
â”‚       â””â”€â”€ chrome-extension.test.js
â”œâ”€â”€ scripts/             # å·¥å…·è…³æœ¬
â”‚   â””â”€â”€ test-chrome-extension.sh   # æ“´å±•æ¸¬è©¦è…³æœ¬
â””â”€â”€ docs/                # æ–‡æª”
```

## é–‹ç™¼è¨­ç½®

### å‰ææ¢ä»¶

- Go 1.21+
- Docker å’Œ Docker Compose
- Make

### å®‰è£

1. å…‹éš†å­˜å„²åº«ï¼š

```bash
git clone https://github.com/yourusername/bookmark-sync-service.git
cd bookmark-sync-service
```

2. å•Ÿå‹•é–‹ç™¼ç’°å¢ƒï¼š

```bash
make dev
```

é€™å°‡å•Ÿå‹•æ‰€æœ‰å¿…è¦çš„æœå‹™ï¼ˆSupabase PostgreSQLã€Redisã€MinIOã€Typesenseï¼‰ã€‚

3. é‹è¡Œå¾Œç«¯ï¼š

```bash
make run
```

### æ¸¬è©¦

é‹è¡Œæ‰€æœ‰æ¸¬è©¦ï¼š

```bash
make test
```

é‹è¡Œç‰¹å®šæ¨¡å¡Šæ¸¬è©¦ï¼š

```bash
# èªè­‰æ¨¡å¡Š
go test -v ./backend/internal/auth/...

# æ›¸ç±¤æ¨¡å¡Š
go test -v ./backend/internal/bookmark/...

# æ”¶è—å¤¾æ¨¡å¡Š
go test -v ./backend/internal/collection/...

# åŒæ­¥æ¨¡å¡Š
go test -v ./backend/internal/sync/...

# Chrome æ“´å±•æ¸¬è©¦ (Phase 5 æ–°å¢)
./scripts/test-chrome-extension.sh

# Firefox æ“´å±•æ¸¬è©¦ (Phase 5 æ–°å¢)
./scripts/test-firefox-extension.sh
```

é‹è¡ŒåŒæ­¥åŠŸèƒ½æ¸¬è©¦è…³æœ¬ï¼š

```bash
# æ¸¬è©¦å¯¦æ™‚åŒæ­¥åŠŸèƒ½
./scripts/test-sync.sh

# æ¸¬è©¦æ”¶è—å¤¾åŠŸèƒ½
./scripts/test-collections.sh
```

ç”Ÿæˆæ¸¬è©¦è¦†è“‹ç‡å ±å‘Šï¼š

```bash
make coverage
```

### æ¸¬è©¦è¦†è“‹ç‡

- **ç¸½é«”æ¸¬è©¦**: 150+ å€‹æ¸¬è©¦ç”¨ä¾‹
- **å¾Œç«¯æ¨¡å¡Š**: 100+ æ¸¬è©¦é€šé (100% æˆåŠŸç‡)
- **ç€è¦½å™¨æ“´å±•**: 100+ æ¸¬è©¦ç”¨ä¾‹ï¼Œæ¶µè“‹ Chrome å’Œ Firefox æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
- **æ ¸å¿ƒåŠŸèƒ½**: å®Œæ•´çš„ TDD æ¸¬è©¦è¦†è“‹

### API ç«¯é»

#### å·²å¯¦ç¾çš„ API

- **èªè­‰**: `/api/v1/auth/*` - ç”¨æˆ¶è¨»å†Šã€ç™»éŒ„ã€JWT é©—è­‰
- **ç”¨æˆ¶**: `/api/v1/users/*` - ç”¨æˆ¶è³‡æ–™ç®¡ç†
- **æ›¸ç±¤**: `/api/v1/bookmarks/*` - å®Œæ•´ CRUDã€æœç´¢ã€æ¨™ç±¤
- **æ”¶è—å¤¾**: `/api/v1/collections/*` - åˆ†å±¤ç®¡ç†ã€å…±äº«ã€æ¬Šé™
- **åŒæ­¥**: `/api/v1/sync/*` - å¯¦æ™‚åŒæ­¥ã€WebSocket é€£æ¥

#### WebSocket ç«¯é»

- **å¯¦æ™‚åŒæ­¥**: `ws://localhost:8080/api/v1/sync/ws`
  - æ”¯æŒ ping/pong å¿ƒè·³æª¢æ¸¬
  - å¯¦æ™‚äº‹ä»¶å»£æ’­
  - å¢é‡åŒæ­¥è«‹æ±‚

API æ–‡æª”å¯åœ¨ `http://localhost:8080/swagger/index.html` ç²å–ï¼ˆç•¶æœå‹™å™¨é‹è¡Œæ™‚ï¼‰ã€‚

## éƒ¨ç½²

### ä½¿ç”¨ Docker Compose

```bash
docker-compose -f docker-compose.prod.yml up -d
```

### æ“´å±• API æœå‹™

```bash
docker-compose up --scale api=3
```

## é…ç½®

é…ç½®é€šéç’°å¢ƒè®Šé‡æˆ–é…ç½®æ–‡ä»¶æä¾›ã€‚æŸ¥çœ‹ `.env.example` æ–‡ä»¶äº†è§£å¯ç”¨çš„é…ç½®é¸é …ã€‚

### é—œéµé…ç½®é …

```bash
# æ•¸æ“šåº«é…ç½®
DATABASE_URL=postgres://user:pass@localhost:5432/bookmarks

# Redis é…ç½® (ç”¨æ–¼å¯¦æ™‚åŒæ­¥)
REDIS_URL=redis://localhost:6379

# JWT é…ç½®
JWT_SECRET=your-secret-key

# Supabase é…ç½®
SUPABASE_URL=http://localhost:3000
SUPABASE_ANON_KEY=your-anon-key
```

## æ€§èƒ½ç‰¹æ€§

### Phase 4 åŒæ­¥æ€§èƒ½

- **å»¶é²**: äºç§’ç´šå¯¦æ™‚åŒæ­¥ (< 1 ç§’)
- **å¸¶å¯¬å„ªåŒ–**: äº‹ä»¶å»é‡æ¸›å°‘ 70% ç¶²çµ¡ä½¿ç”¨
- **ä¸¦ç™¼æ”¯æŒ**: æ”¯æŒæ•¸åƒå€‹ä¸¦ç™¼ WebSocket é€£æ¥
- **è¡çªè§£æ±º**: æ™ºèƒ½æ™‚é–“æˆ³è¡çªè§£æ±º
- **é›¢ç·šæ¢å¾©**: è‡ªå‹•é›¢ç·šäº‹ä»¶éšŠåˆ—è™•ç†

## è²¢ç»

1. Fork å­˜å„²åº«
2. å‰µå»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. æ‰“é–‹æ‹‰å–è«‹æ±‚

## è¨±å¯è­‰

[MIT](LICENSE)